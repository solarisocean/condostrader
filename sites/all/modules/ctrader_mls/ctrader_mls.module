<?php
/**
 * Created by PhpStorm.
 * User: aryan
 * Date: 03.04.16
 * Time: 15:50
 */

/**
 * Implements hook_menu().
 */
function ctrader_mls_menu() {
  $items['admin/config/mls'] = array(
    'title' => 'Mls integration page',
    'page callback' => 'drupal_get_form',
    'page arguments' => array('ctrader_mls_form'),
    'access arguments' => array('administer modules'),
    'type' => MENU_NORMAL_ITEM,
  );
  $items['admin/config/rets'] = array(
    'title' => 'RETS settings page',
    'page callback' => 'drupal_get_form',
    'page arguments' => array('ctrader_mls_rets_data_form'),
    'access arguments' => array('administer modules'),
    'type' => MENU_NORMAL_ITEM,
  );
  $items['rets-connection-test'] = array(
    'title' => 'RETS connection',
    'page callback' => '_rets_connection_test',
    'access arguments' => array('administer modules'),
    'file' => 'inc/ctrader_mls.rets_connection.inc',
  );
  $items['rets-xml-parser'] = array(
    'title' => 'RETS xml parser',
    'page callback' => '_rets_xml_parser',
    'access arguments' => array('administer modules'),
    'file' => 'inc/ctrader_mls.rets_xml_parser.inc',
    'type' => MENU_NORMAL_ITEM,
  );

  return $items;
}

/**
 * Form for configure integration drupal and mls.
 */
function ctrader_mls_form($form, &$form_state) {
  $form['mls_username'] = array(
    '#type' => 'textfield',
    '#title' => t('Username'),
    '#default_value' => variable_get('mls_username', ''),
  );

  $form['mls_password'] = array(
    '#type' => 'password',
    '#title' => t('Password'),
  );

  return system_settings_form($form);
}

/**
 * Form for configure RETS server login data.
 */
function ctrader_mls_rets_data_form($form, &$form_state) {
  $form['rets_login_url'] = array(
    '#type' => 'textfield',
    '#title' => t('RETS login url'),
    '#default_value' => variable_get('rets_login_url', ''),
  );

  $form['rets_username'] = array(
    '#type' => 'textfield',
    '#title' => t('RETS username'),
    '#default_value' => variable_get('rets_username', ''),
  );

  $form['rets_password'] = array(
    '#type' => 'textfield',
    '#title' => t('RETS password'),
    '#default_value' => variable_get('rets_password', ''),

  );

  $form['rets_user_agent'] = array(
    '#type' => 'textfield',
    '#title' => t('RETS user agent'),
    '#default_value' => variable_get('rets_user_agent', ''),
  );

  $form['rets_user_agent_password'] = array(
    '#type' => 'textfield',
    '#title' => t('RETS user agent password'),
    '#default_value' => variable_get('rets_user_agent_password', ''),

  );

  return system_settings_form($form);
}


/**
 * Implements hook_libraries_info().
 */
function ctrader_mls_libraries_info() {
  $libraries['torontomlsapi'] = array(
    'name' => 'Torontomlsapi',
    'vendor url' => 'https://github.com/tamtranvn2012/torontomlsapi',
    'download url' => 'https://github.com/tamtranvn2012/torontomlsapi/archive/master.zip',
    'version arguments' => array(
      'file' => 'phrets.php',
      'pattern' => '@version\s+([0-9a-zA-Z\.-]+)@',
    ),
    'files' => array(
      'php' => array(
        'phrets.php',
      ),
    ),
  );

  return $libraries;
}
